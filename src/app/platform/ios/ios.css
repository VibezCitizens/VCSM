/* ============================================================
   iOS PLATFORM BASE
   ============================================================
   Purpose:
   - Lock viewport height on iOS Safari
   - Prevent Safari from scrolling the document
*/

html.ios-keyboard {
  height: 100%;
}

html.ios-keyboard body {
  height: 100%;
  overflow: hidden;
  overscroll-behavior: none;
}


/* ============================================================
   CHAT SCREEN ROOT
   ============================================================
   Purpose:
   - Fixed full-screen container
   - Prevents layout shifts
*/

.chat-screen {
  position: fixed;
  inset: 0;
  background: black;
}


/* ============================================================
   HEADER
   ============================================================
   Purpose:
   - Fixed chat header
   - Does NOT move with keyboard
*/

.chat-header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 64px;
  z-index: 10;
}


/* ============================================================
   FOOTER (INPUT HOLDER)
   ============================================================
   Purpose:
   - Holds ChatInput
   - Moves UP when iOS keyboard opens (Safari only)
   - Does NOT affect message list directly
*/

.chat-footer {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;

  min-height: 88px;
  padding-bottom: env(safe-area-inset-bottom);

  background: black;
  z-index: 10;

  /*
    Safari keyboard handling:
    --ios-kb-offset is NEGATIVE when keyboard opens
    This transform visually moves the footer upward
  */
  transform: translateY(var(--ios-kb-offset, 0px));
  will-change: transform;

  /*
    UX polish:
    - Does NOT make it faster
    - Smooths the return when keyboard closes
    - Matches native iOS easing
  */
  transition: transform 120ms cubic-bezier(0.33, 1, 0.68, 1);
}



/* ============================================================
   MESSAGE LIST (SCROLLABLE AREA)
   ============================================================
   Purpose:
   - Scrollable message viewport
   - Bottom boundary dynamically follows footer movement
   - Guarantees last message is NEVER hidden
*/

.chat-messages {
  position: absolute;
  top: 64px; /* below header */

  /*
    üîë CRITICAL LOGIC:

    - Footer moves UP by -var(--ios-kb-offset)
    - Message list bottom MUST shrink by same amount
    - Convert negative offset into positive keyboard height

    Result:
    Messages remain visible above input + keyboard
  */
  bottom: calc(
    88px +
    env(safe-area-inset-bottom) +
    max(0px, calc(-1 * var(--ios-kb-offset, 0px)))
  );

  left: 0;
  right: 0;

  overflow-y: auto;
  -webkit-overflow-scrolling: touch;

  /*
    Scroll anchoring safety:
    - Ensures scrollIntoView respects input height
    - Prevents last message from hiding behind footer
  */
  padding-bottom: calc(1px + env(safe-area-inset-bottom));
  scroll-padding-bottom: calc(1px + env(safe-area-inset-bottom));

  will-change: contents;
}


/* ============================================================
   SAFETY / QUALITY OF LIFE
   ============================================================
*/

/* Prevent Safari zoom on input focus */
input,
textarea {
  font-size: 16px;
}

/* Remove tap highlight artifacts */
* {
  -webkit-tap-highlight-color: transparent;
}


/* ============================================================
   iOS PWA OVERRIDES
   ============================================================
   Context:
   - In iOS PWA mode, Apple freezes visualViewport
   - Keyboard overlays screen instead of resizing it
   - Footer MUST be fixed
   - No transform math allowed
*/

/* Footer stays fixed in PWA */
html.ios-pwa .chat-footer {
  position: fixed;
  left: 0;
  right: 0;
  bottom: env(safe-area-inset-bottom);

  z-index: 20;

  /* ‚ùå Disable Safari keyboard transform logic */
  transform: none;
}

/* Message list only accounts for footer height */
html.ios-pwa .chat-messages {
  bottom: calc(88px + env(safe-area-inset-bottom));
}
